
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Log√≠sticaT√∫</title>
  <meta name="description" content="Portal de gesti√≥n de env√≠os y flota ‚Äì Log√≠sticaT√∫üáµüáæ"/>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <!-- Leaflet Routing Machine CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>

  <style>
    :root {
      --bg: #ffffff;
      --bg-alt: #f5f7fa;
      --text: #111827;
      --accent: #0b9e6f;
      --radius: .75rem;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);display:grid;grid-template-rows:auto 1fr auto;min-height:100vh}
    header,footer{padding:1rem 2rem}
    header{display:flex;align-items:center;justify-content:space-between;background:var(--bg-alt);border-bottom:1px solid #00000011}
    header h1{font-size:1.5rem}
    #searchToggle{cursor:pointer;background:none;border:0;font-size:1.5rem}
    #searchBar{display:none;width:100%;padding:.5rem;margin-top:.5rem;border:1px solid var(--accent);border-radius:var(--radius)}
    main{padding:2rem;display:grid;gap:2rem;grid-template-columns:1fr 1fr}
    section{background:var(--bg-alt);padding:1.5rem;border-radius:var(--radius);box-shadow:0 2px 6px #0000001a}
    h2{margin-bottom:1rem}
    label{display:block;margin-top:.75rem;font-weight:600}
    input,select,textarea{width:100%;padding:.5rem;margin-top:.25rem;border:1px solid var(--accent);border-radius:var(--radius);background:var(--bg);color:var(--text)}
    button[type="submit"]{margin-top:1rem;padding:.6rem 1.2rem;background:var(--accent);border:0;border-radius:var(--radius);color:#fff;font-weight:600;cursor:pointer}
    button[type="submit"]:hover{opacity:.9}
    #precioEstimado{margin-top:.5rem;font-weight:700}
    #map{height:400px;border-radius:var(--radius)}
    footer{text-align:center;font-size:.875rem;opacity:.7}
    @media (max-width:900px){main{grid-template-columns:1fr}}
  </style>
</head>

<body>
<header style="background:var(--accent); color:#fff; border-bottom:1px solid #00000011; padding:1rem 2rem; display:flex; flex-direction:column; gap:.75rem;">
  <!-- T√≠tulo con √≠cono -->
  <div style="display:flex;align-items:center;justify-content:space-between;">
    <h1 style="font-size:1.5rem;display:flex;align-items:center;gap:.5rem;">üöö Log√≠sticaT√∫</h1>
    <button id="searchToggle" aria-label="Buscar" title="Buscar" style="cursor:pointer;background:none;border:0;font-size:1.5rem;color:#fff;">üîç</button>
  </div>

  <!-- Botones debajo del t√≠tulo -->
  <div style="display:flex;gap:1rem;justify-content:flex-start;">
    <a href="tel:+595983559813" style="display:flex;align-items:center;text-decoration:none;color:#fff;font-weight:600;">
      üìû <span style="margin-left:.4rem;">Llamar</span>
    </a>
    <a href="https://wa.me/595983559813" target="_blank" style="display:flex;align-items:center;text-decoration:none;color:#fff;font-weight:600;">
      üí¨ <span style="margin-left:.4rem;">WhatsApp</span>
    </a>
  </div>
</header>

  <input id="searchBar" type="search" placeholder="Buscar env√≠os, clientes, conductores‚Ä¶"/>

  <main>
    main {
  padding-top: 2rem;
}
    <section id="misViajes" style="margin:2rem 0;">
  <h2>üìã Mis viajes</h2>
  <div id="listaViajes" style="display:flex;flex-direction:column;gap:1rem;"></div>
</section>
    <section>
      <h2>Alta de nuevo env√≠o</h2>
      <form id="altaForm">
        <label>Cliente
          <input type="text" name="cliente" required/>
        </label>

        <label>Origen
          <input type="text" id="origen" name="origen" placeholder="Calle N¬∫, Ciudad, Paraguay" required/>
        </label>

        <label>Destino
          <input type="text" id="destino" name="destino" placeholder="Calle N¬∫, Ciudad, Paraguay" required/>
        </label>

        <label>Kil√≥metro (km)
          <input type="number" name="peso" min="0.1" step="0.1" required readonly/>
        </label>

        <label>Tipo de servicio
          <select name="servicio" required>
            <option value="liviana">Liviana</option>
            <option value="mediana">Mediana</option>
            <option value="pesada">Pesada</option>
          </select>
        </label>

        <label>Observaciones
          <textarea name="obs" rows="2"></textarea>
        </label>

        <p id="precioEstimado">Precio estimado: ‚Ç≤0</p>

        <button type="submit">Registrar env√≠o</button>
      </form>
    </section>

    <section>
      <h2>Ruta ‚Äì Paraguay</h2>
      <div id="map"></div>
    </section>
  </main>

  <footer>
    &copy; 2025 Log√≠sticaT√∫ ‚Äì Derechos Reservados a Marcelo Benitez Noguera | HTML5
  </footer>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Leaflet Routing Machine -->
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

  <script>
    /* ----------  Buscador  ---------- */
    const btn = document.getElementById('searchToggle');
    const bar = document.getElementById('searchBar');
    btn.addEventListener('click', () => { bar.style.display = bar.style.display === 'block' ? 'none' : 'block'; bar.focus(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') bar.style.display = 'none'; });

    /* ----------  Precio  ---------- */
    const form = document.getElementById('altaForm');
    const precioOut = document.getElementById('precioEstimado');

    function calcularPrecio() {
      const km = parseFloat(form.peso.value) || 0;
      const servicio = form.servicio.value;
      const tarifas = { liviana: 5000, mediana: 30000, pesada: 40000 };
      const precio = km * tarifas[servicio];
      precioOut.textContent = `Precio estimado: ‚Ç≤${precio.toLocaleString('es-PY')}`;
    }
    form.querySelectorAll('input, select').forEach(el => el.addEventListener('input', calcularPrecio));

    /* ----------  Mapa y ruta  ---------- */
    const map = L.map('map').setView([-25.2637, -57.5759], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const icons = {
      green: new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] }),
      red:   new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',   shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] })
    };

    let oMarker, dMarker, router;

    function geocode(dir, cb) {
      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(dir + ', Paraguay')}`)
        .then(r => r.json())
        .then(d => d[0] ? cb(+d[0].lat, +d[0].lon) : alert('Direcci√≥n no encontrada'));
    }

    function actualizarRuta() {
      const orig = form.origen.value.trim(), dest = form.destino.value.trim();
      if (!orig || !dest) return;

      geocode(orig, (lat1, lng1) => {
        geocode(dest, (lat2, lng2) => {
          if (oMarker) map.removeLayer(oMarker);
          if (dMarker) map.removeLayer(dMarker);
          if (router) map.removeControl(router);

          oMarker = L.marker([lat1, lng1], { icon: icons.green }).addTo(map).bindPopup('Origen');
          dMarker = L.marker([lat2, lng2], { icon: icons.red   }).addTo(map).bindPopup('Destino');
          map.fitBounds([[lat1, lng1], [lat2, lng2]]);

          router = L.Routing.control({
            waypoints: [L.latLng(lat1, lng1), L.latLng(lat2, lng2)],
            routeWhileDragging: false,
            createMarker: () => null,
            lineOptions: { styles: [{ color: '#0b9e6f', weight: 5 }] }
          }).addTo(map);

          router.on('routesfound', e => {
            const km = (e.routes[0].summary.totalDistance / 1000).toFixed(1);
            form.peso.value = km;
            calcularPrecio();
          });
        });
      });
    }

    form.origen.addEventListener('change', actualizarRuta);
    form.destino.addEventListener('change', actualizarRuta);

    /* ----------  Registrar env√≠o  ---------- */
    form.addEventListener('submit', e => {
      e.preventDefault();
      alert('Env√≠o registrado en Log√≠sticaT√∫');
      form.reset();
      calcularPrecio();
    });
    function generarQR(texto) {
  const canvas = document.createElement('canvas');
  new QRCode(canvas, { text: texto, width: 120, height: 120 });
  return canvas;
}

function registrarViajeLocal(data) {
  const lista = document.getElementById('listaViajes');

  const textoQR = `üéüÔ∏è Ticket de env√≠o\nCliente: ${data.cliente}\nOrigen: ${data.origen}\nDestino: ${data.destino}\nDistancia: ${data.km} km\nServicio: ${data.servicio}\nPrecio estimado: ‚Ç≤${data.precio}`;
  const qrCanvas = generarQR(textoQR);

  const viaje = document.createElement('div');
  viaje.style.border = '1px solid #ccc';
  viaje.style.borderRadius = '1rem';
  viaje.style.padding = '1rem';
  viaje.style.background = '#f5f7fa';

  viaje.innerHTML = `
    <p><strong>Cliente:</strong> ${data.cliente}</p>
    <p><strong>Ruta:</strong> ${data.origen} ‚Üí ${data.destino}</p>
    <p><strong>Servicio:</strong> ${data.servicio}</p>
    <p><strong>Precio:</strong> ‚Ç≤${data.precio}</p>
    <button onclick="enviarWhatsApp('${textoQR}')">üì≤ Enviar a WhatsApp</button>
  `;

  viaje.appendChild(qrCanvas);
  lista.appendChild(viaje);
}

function enviarWhatsApp(msg) {
  const mensaje = encodeURIComponent(msg);
  window.open(`https://wa.me/595983559813?text=${mensaje}`, '_blank');
}

// Modificamos el env√≠o del formulario:
form.addEventListener('submit', e => {
  e.preventDefault();
  const data = {
    cliente: form.cliente.value,
    origen: form.origen.value,
    destino: form.destino.value,
    km: parseFloat(form.peso.value || 0),
    servicio: form.servicio.value,
    precio: (parseFloat(form.peso.value) * (form.servicio.value === "liviana" ? 5000 : form.servicio.value === "mediana" ? 30000 : 40000)).toLocaleString('es-PY')
  };
  registrarViajeLocal(data);
  alert('Env√≠o registrado en Log√≠sticaT√∫');
  form.reset();
  calcularPrecio();
});
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  </script>
</body>
</html>

