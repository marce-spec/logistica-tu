
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Log√≠sticaT√∫</title>
  <meta name="description" content="Portal de gesti√≥n de env√≠os y flota ‚Äì Log√≠sticaT√∫üáµüáæ"/>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <!-- Leaflet Routing Machine CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"/>

  <style>
    :root {
      --bg: #ffffff;
      --bg-alt: #f5f7fa;
      --text: #111827;
      --accent: #0b9e6f;
      --radius: .75rem;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);display:grid;grid-template-rows:auto 1fr auto;min-height:100vh}
    header,footer{padding:1rem 2rem}
    header{display:flex;align-items:center;justify-content:space-between;background:var(--bg-alt);border-bottom:1px solid #00000011}
    header h1{font-size:1.5rem}
    #searchToggle{cursor:pointer;background:none;border:0;font-size:1.5rem}
    #searchBar{display:none;width:100%;padding:.5rem;margin-top:.5rem;border:1px solid var(--accent);border-radius:var(--radius)}
    main{padding:2rem;display:grid;gap:2rem;grid-template-columns:1fr 1fr}
    section{background:var(--bg-alt);padding:1.5rem;border-radius:var(--radius);box-shadow:0 2px 6px #0000001a}
    h2{margin-bottom:1rem}
    label{display:block;margin-top:.75rem;font-weight:600}
    input,select,textarea{width:100%;padding:.5rem;margin-top:.25rem;border:1px solid var(--accent);border-radius:var(--radius);background:var(--bg);color:var(--text)}
    button[type="submit"]{margin-top:1rem;padding:.6rem 1.2rem;background:var(--accent);border:0;border-radius:var(--radius);color:#fff;font-weight:600;cursor:pointer}
    button[type="submit"]:hover{opacity:.9}
    #precioEstimado{margin-top:.5rem;font-weight:700}
    #map{height:400px;border-radius:var(--radius)}
    footer{text-align:center;font-size:.875rem;opacity:.7}
    @media (max-width:900px){main{grid-template-columns:1fr}}
  </style>
</head>

<body>
  <header>
    <h1>Log√≠sticaT√∫</h1>
    <div style="display:flex;align-items:center;gap:1.5rem;">
      <a href="tel:+595983559813" style="display:flex;align-items:center;text-decoration:none;color:var(--accent);font-weight:600;">
        <svg height="20" viewBox="0 0 24 24" width="20" fill="currentColor" style="margin-right:.5rem"><path d="M6.62 10.79a15.093 15.093 0 006.59 6.59l2.2-2.2a1.003 1.003 0 011.11-.27c1.12.45 2.33.68 3.59.68a1 1 0 011 1v3.59a1 1 0 01-1 1C9.27 22 2 14.73 2 6.41a1 1 0 011-1h3.59a1 1 0 011 1c0 1.26.23 2.47.68 3.59.11.26.04.55-.27 1.11l-2.38 2.38z"/></svg>
        +595 983 559813
      </a>
      <a href="https://wa.me/595983559813" target="_blank" style="display:flex;align-items:center;text-decoration:none;color:var(--accent);font-weight:600;">
        <svg height="20" viewBox="0 0 448 512" width="20" fill="currentColor" style="margin-right:.5rem"><path d="M380.9 97.1C339.3 55.5 284.2 32 224.1 32 102.4 32 3 131.1 3 252.7c0 49.6 13.6 98.2 39.6 140.6L0 480l89.6-42.2c40.1 22.2 84.9 33.9 129.7 33.9h.1c121.7 0 220.1-99.1 220.1-220.6.1-60.1-23.5-115.3-65.6-154zm-156.8 349c-38.1 0-75.4-10.3-108.1-29.8l-7.7-4.6-53.2 25.1 11.3-54.9-4.4-7c-23-36.5-35.2-78.7-35.2-121.4 0-119.4 97.2-216.4 216.8-216.4 57.9 0 112.4 22.6 153.4 63.7 40.9 41 63.6 95.5 63.5 153.5 0 119.4-97.2 216.4-216.4 216.4zm121.8-155.4l-17.3-8.7c-2.3-1.2-5-1.1-7.2.3l-24.6 15.2a6.8 6.8 0 01-7.5-.5c-9.9-7.8-26.9-23.1-38.1-37.9-11.3-14.9-17.1-27.3-19.6-32.6a6.7 6.7 0 01.6-7.3l15.1-24.5c1.5-2.4 1.6-5.3.3-7.7l-8.9-17.1c-2.7-5.2-9-7.5-14.4-5.2l-8.3 3.4c-4 1.7-7.3 4.6-9.5 8.4-3.3 5.6-6.3 12.1-6.4 18.5-.3 16 5.2 35.3 30.4 64.6 26.7 31.1 49.4 39.1 66.4 40.1 6.5.4 12.8-2.1 17.9-6.3 3.6-3 6.6-6.7 8.9-10.8l3.4-8.2c2.2-5.2-.1-11.3-5.4-14z"/></svg>
        WhatsApp
      </a>
    </div>
    <button id="searchToggle" aria-label="Buscar" title="Buscar">üîç</button>
  </header>

  <input id="searchBar" type="search" placeholder="Buscar env√≠os, clientes, conductores‚Ä¶"/>

  <main>
    <section>
      <h2>Alta de nuevo env√≠o</h2>
      <form id="altaForm">
        <label>Cliente
          <input type="text" name="cliente" required/>
        </label>

        <label>Origen
          <input type="text" id="origen" name="origen" placeholder="Calle N¬∫, Ciudad, Paraguay" required/>
        </label>

        <label>Destino
          <input type="text" id="destino" name="destino" placeholder="Calle N¬∫, Ciudad, Paraguay" required/>
        </label>

        <label>Kil√≥metro (km)
          <input type="number" name="peso" min="0.1" step="0.1" required readonly/>
        </label>

        <label>Tipo de servicio
          <select name="servicio" required>
            <option value="liviana">Liviana</option>
            <option value="mediana">Mediana</option>
            <option value="pesada">Pesada</option>
          </select>
        </label>

        <label>Observaciones
          <textarea name="obs" rows="2"></textarea>
        </label>

        <p id="precioEstimado">Precio estimado: ‚Ç≤0</p>

        <button type="submit">Registrar env√≠o</button>
      </form>
    </section>

    <section>
      <h2>Ruta ‚Äì Paraguay</h2>
      <div id="map"></div>
    </section>
  </main>

  <footer>
    &copy; 2025 Log√≠sticaT√∫ ‚Äì Derechos Reservados a Marcelo Benitez Noguera | HTML5
  </footer>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Leaflet Routing Machine -->
  <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

  <script>
    /* ----------  Buscador  ---------- */
    const btn = document.getElementById('searchToggle');
    const bar = document.getElementById('searchBar');
    btn.addEventListener('click', () => { bar.style.display = bar.style.display === 'block' ? 'none' : 'block'; bar.focus(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') bar.style.display = 'none'; });

    /* ----------  Precio  ---------- */
    const form = document.getElementById('altaForm');
    const precioOut = document.getElementById('precioEstimado');

    function calcularPrecio() {
      const km = parseFloat(form.peso.value) || 0;
      const servicio = form.servicio.value;
      const tarifas = { liviana: 5000, mediana: 30000, pesada: 40000 };
      const precio = km * tarifas[servicio];
      precioOut.textContent = `Precio estimado: ‚Ç≤${precio.toLocaleString('es-PY')}`;
    }
    form.querySelectorAll('input, select').forEach(el => el.addEventListener('input', calcularPrecio));

    /* ----------  Mapa y ruta  ---------- */
    const map = L.map('map').setView([-25.2637, -57.5759], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const icons = {
      green: new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] }),
      red:   new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',   shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] })
    };

    let oMarker, dMarker, router;

    function geocode(dir, cb) {
      fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(dir + ', Paraguay')}`)
        .then(r => r.json())
        .then(d => d[0] ? cb(+d[0].lat, +d[0].lon) : alert('Direcci√≥n no encontrada'));
    }

    function actualizarRuta() {
      const orig = form.origen.value.trim(), dest = form.destino.value.trim();
      if (!orig || !dest) return;

      geocode(orig, (lat1, lng1) => {
        geocode(dest, (lat2, lng2) => {
          if (oMarker) map.removeLayer(oMarker);
          if (dMarker) map.removeLayer(dMarker);
          if (router) map.removeControl(router);

          oMarker = L.marker([lat1, lng1], { icon: icons.green }).addTo(map).bindPopup('Origen');
          dMarker = L.marker([lat2, lng2], { icon: icons.red   }).addTo(map).bindPopup('Destino');
          map.fitBounds([[lat1, lng1], [lat2, lng2]]);

          router = L.Routing.control({
            waypoints: [L.latLng(lat1, lng1), L.latLng(lat2, lng2)],
            routeWhileDragging: false,
            createMarker: () => null,
            lineOptions: { styles: [{ color: '#0b9e6f', weight: 5 }] }
          }).addTo(map);

          router.on('routesfound', e => {
            const km = (e.routes[0].summary.totalDistance / 1000).toFixed(1);
            form.peso.value = km;
            calcularPrecio();
          });
        });
      });
    }

    form.origen.addEventListener('change', actualizarRuta);
    form.destino.addEventListener('change', actualizarRuta);

    /* ----------  Registrar env√≠o  ---------- */
    form.addEventListener('submit', e => {
      e.preventDefault();
      alert('Env√≠o registrado en Log√≠sticaT√∫');
      form.reset();
      calcularPrecio();
    });
  </script>
</body>
</html>
